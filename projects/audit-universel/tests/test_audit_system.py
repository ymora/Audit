#!/usr/bin/env python3
"""
Test du syst√®me d'audit pour le projet audit-universel.
"""

import sys
from pathlib import Path

# Ajouter le framework au path
sys.path.insert(0, str(Path(__file__).parent.parent.parent / "tests"))

from generic.base_test import BaseProjectTest
from generic.api_test import APITestMixin
from generic.security_test import SecurityTestMixin

class AuditSystemTest(BaseProjectTest, SecurityTestMixin):
    """Test du syst√®me d'audit."""
    
    async def run_test(self):
        """Ex√©cute le test du syst√®me d'audit."""
        print("üîç Test du syst√®me d'audit...")
        
        # V√©rifier que les fichiers principaux existent
        core_files = [
            "audit.py",
            "core/audit_gui.py",
            "core/audit.py",
            "core/init_audit.py"
        ]
        
        missing_files = []
        for file_path in core_files:
            full_path = self.project_path / file_path
            if not full_path.exists():
                missing_files.append(file_path)
        
        if missing_files:
            self.log_failure(f"Fichiers manquants: {missing_files}")
        else:
            self.log_success("Tous les fichiers principaux pr√©sents")
        
        # Test de s√©curit√© sur le code
        security_result = self.run_bandit_scan(self.project_path)
        if security_result["success"]:
            self.log_success("Scan de s√©curit√© r√©ussi")
        else:
            self.log_failure("Probl√®mes de s√©curit√© d√©tect√©s")
        
        return self.results

# Compatibilit√© avec l'ancien syst√®me
async def run_test(project_path: Path, config: dict):
    test = AuditSystemTest(project_path, config)
    return await test.run_test()
