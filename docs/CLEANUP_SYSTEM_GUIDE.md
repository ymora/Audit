# GUIDE DU SYST√àME DE NETTOYAGE AUTOMATIQUE

## Vue d'ensemble

Le syst√®me d'audit universel int√®gre un syst√®me de nettoyage automatique pour les dossiers `.project` qui suit les m√™mes r√®gles que les audits. Ce syst√®me garantit que les projets restent organis√©s et ne prennent pas trop d'espace disque.

## Fonctionnalit√©s

### üßπ Nettoyage automatique
- **Nettoyage apr√®s audit** : Ex√©cut√© automatiquement apr√®s chaque audit
- **Nettoyage global** : Peut √™tre lanc√© manuellement pour tous les projets
- **Configuration flexible** : Chaque projet peut avoir ses propres r√®gles de nettoyage

### üìÅ Gestion intelligente des fichiers
- **R√©tention configurable** : Dur√©e de conservation des fichiers par type
- **Limite de fichiers** : Nombre maximum de fichiers par dossier
- **Archivage automatique** : Conservation des fichiers importants
- **Suppression s√©lective** : Suppression des fichiers les plus anciens

## Configuration

### Configuration par d√©faut

Chaque projet peut avoir sa propre configuration de nettoyage dans :
```
projet/.project/config/cleanup_config.json
```

Configuration par d√©faut :
```json
{
  "enabled": true,
  "retention_days": {
    "logs": 30,
    "reports": 90,
    "tests": 60
  },
  "max_files": {
    "logs": 100,
    "reports": 50,
    "tests": 30
  },
  "archive_enabled": true,
  "archive_path": "archive",
  "cleanup_schedule": "daily"
}
```

### Param√®tres de configuration

| Param√®tre | Description | Valeur par d√©faut |
|-----------|-------------|-------------------|
| `enabled` | Active/d√©sactive le nettoyage | `true` |
| `retention_days.logs` | Jours de conservation des logs | `30` |
| `retention_days.reports` | Jours de conservation des rapports | `90` |
| `retention_days.tests` | Jours de conservation des tests | `60` |
| `max_files.logs` | Nombre max de fichiers de logs | `100` |
| `max_files.reports` | Nombre max de fichiers de rapports | `50` |
| `max_files.tests` | Nombre max de fichiers de tests | `30` |
| `archive_enabled` | Active l'archivage | `true` |
| `cleanup_schedule` | Fr√©quence de nettoyage | `"daily"` |

### Options de planning

- `"daily"` : Nettoyage quotidien
- `"weekly"` : Nettoyage hebdomadaire
- `"monthly"` : Nettoyage mensuel

## Utilisation

### Nettoyage automatique

Le nettoyage s'ex√©cute automatiquement apr√®s chaque audit :
```bash
python audit.py --cli projects/mon_projet
```

### Nettoyage global manuel

Pour nettoyer tous les projets :
```bash
python audit.py --cleanup
```

### Nettoyage d'un projet sp√©cifique

```python
from core.project_cleaner import ProjectCleaner
from pathlib import Path

project_path = Path("projects/mon_projet")
cleaner = ProjectCleaner(project_path)

# V√©rifier si le nettoyage est n√©cessaire
if cleaner.should_run_cleanup():
    results = cleaner.cleanup_project_directory()
    print(f"Espace lib√©r√©: {results['space_freed']} bytes")
```

## R√®gles de nettoyage

### üìù Logs
- **Conservation** : 30 jours par d√©faut
- **Limite** : 100 fichiers maximum
- **Archivage** : Fichiers `.log` importants

### üìã Rapports
- **Conservation** : 90 jours par d√©faut
- **Limite** : 50 fichiers maximum
- **Archivage** : Fichiers `.html`, `.json`, `.md`

### üß™ Tests
- **Conservation** : 60 jours par d√©faut
- **Limite** : 30 fichiers maximum
- **Archivage** : Fichiers de test importants

## Archivage

### Fichiers archiv√©s
Les fichiers suivants sont automatiquement archiv√©s :
- `.html` : Rapports HTML
- `.json` : Rapports JSON
- `.md` : Documentation Markdown
- `.log` : Logs importants

### Structure d'archivage
```
projet/.project/archive/
‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îú‚îÄ‚îÄ audit_20250819_115223_20250819_120000.log
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ reports/
‚îÇ   ‚îú‚îÄ‚îÄ audit_report_20250819_115223_20250819_120000.html
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ ...
```

## Rapports de nettoyage

### Rapport automatique
Apr√®s chaque nettoyage global, un rapport est g√©n√©r√© dans :
```
docs/cleanup_report_YYYYMMDD_HHMMSS.md
```

### Contenu du rapport
- R√©sum√© du nettoyage
- D√©tails par projet
- Espace lib√©r√©
- Erreurs √©ventuelles

### Exemple de rapport
```markdown
# RAPPORT DE NETTOYAGE AUTOMATIQUE
Date: 2025-08-19 11:52:23

## R√©sum√©
- **Projets trait√©s:** 2
- **Projets nettoy√©s:** 2
- **Projets ignor√©s:** 0
- **Espace lib√©r√©:** 1.25 MB

## D√©tails par projet

### audit-universel
- **Statut:** success
- **Timestamp:** 2025-08-19T11:52:23

#### logs/
- Fichiers v√©rifi√©s: 15
- Fichiers supprim√©s: 5
- Fichiers archiv√©s: 2
- Espace lib√©r√©: 256.50 KB
```

## Int√©gration avec l'audit

### D√©clenchement automatique
Le nettoyage est automatiquement d√©clench√© :
1. Apr√®s chaque audit de projet
2. Selon le planning configur√©
3. Si l'espace disque est insuffisant

### Logs de nettoyage
Les actions de nettoyage sont enregistr√©es dans :
```
projet/.project/logs/cleanup_YYYYMMDD_HHMMSS.log
```

## Personnalisation

### Configuration personnalis√©e
Pour personnaliser le nettoyage d'un projet :

1. Cr√©er le fichier de configuration :
```bash
mkdir -p projet/.project/config
```

2. √âditer `projet/.project/config/cleanup_config.json` :
```json
{
  "enabled": true,
  "retention_days": {
    "logs": 60,
    "reports": 180,
    "tests": 90
  },
  "max_files": {
    "logs": 200,
    "reports": 100,
    "tests": 50
  },
  "archive_enabled": true,
  "cleanup_schedule": "weekly"
}
```

### D√©sactivation du nettoyage
Pour d√©sactiver le nettoyage d'un projet :
```json
{
  "enabled": false
}
```

## Surveillance et maintenance

### V√©rification des statistiques
```python
from core.project_cleaner import ProjectCleaner

cleaner = ProjectCleaner(project_path)
stats = cleaner.get_cleanup_stats()
print(f"Taille totale: {stats['total_size']} bytes")
print(f"Dernier nettoyage: {stats['last_cleanup']}")
```

### Nettoyage manuel des archives
Les archives peuvent √™tre nettoy√©es manuellement :
```bash
# Supprimer les archives de plus de 1 an
find projet/.project/archive -type f -mtime +365 -delete
```

## Bonnes pratiques

### ‚úÖ Recommandations
1. **Configurer selon l'usage** : Ajuster les dur√©es selon l'activit√© du projet
2. **Surveiller l'espace** : V√©rifier r√©guli√®rement l'utilisation du disque
3. **Archiver les rapports importants** : Garder les rapports critiques
4. **Tester la configuration** : V√©rifier que le nettoyage fonctionne comme attendu

### ‚ùå √Ä √©viter
1. **D√©sactiver compl√®tement** : Le nettoyage est important pour la maintenance
2. **Dur√©es trop courtes** : Risque de perdre des informations importantes
3. **Limites trop √©lev√©es** : Peut consommer beaucoup d'espace disque
4. **Ignorer les erreurs** : Toujours v√©rifier les rapports de nettoyage

## D√©pannage

### Probl√®mes courants

#### Nettoyage ne s'ex√©cute pas
- V√©rifier que `enabled: true` dans la configuration
- Contr√¥ler le planning de nettoyage
- V√©rifier les permissions sur les dossiers

#### Erreurs d'archivage
- V√©rifier l'espace disque disponible
- Contr√¥ler les permissions d'√©criture
- V√©rifier que le dossier archive existe

#### Fichiers non supprim√©s
- V√©rifier les dates de modification
- Contr√¥ler les limites de fichiers
- V√©rifier les permissions de suppression

### Logs de d√©bogage
Pour activer les logs d√©taill√©s, ajouter dans la configuration :
```json
{
  "debug": true,
  "log_level": "verbose"
}
```

## Support

Pour toute question ou probl√®me :
1. Consulter les logs de nettoyage
2. V√©rifier la configuration du projet
3. Tester avec le nettoyage manuel
4. Consulter la documentation du projet

---

*Ce guide est maintenu avec le syst√®me d'audit universel v2.0.0*
